<Window
    x:Class="WUView.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:WUView"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:p="clr-namespace:WUView.Properties"
    Title="Windows Update Viewer"
    Width="400"
    MinWidth="300"
    MinHeight="250"
    Closing="Window_Closing"
    KeyDown="Window_KeyDown"
    SizeToContent="Width"
    mc:Ignorable="d">

    <!--#region Styles-->
    <Window.Resources>
        <Style x:Key="ColumnMargin5" TargetType="TextBlock">
            <Setter Property="Margin" Value="5,0,5,0" />
        </Style>
        <Style x:Key="MyWaterMarkStyle" TargetType="{x:Type TextBox}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TextBox}">
                        <Grid>
                            <Border
                                Background="White"
                                BorderBrush="LightGray"
                                BorderThickness="1" />
                            <ScrollViewer
                                x:Name="PART_ContentHost"
                                Margin="5,0,0,0"
                                VerticalAlignment="Center" />
                            <Label
                                x:Name="WaterMarkLabel"
                                Margin="5,-3,0,0"
                                VerticalAlignment="Center"
                                Content="{TemplateBinding Tag}"
                                FontSize="14"
                                Foreground="LightGray"
                                Visibility="Collapsed" />
                        </Grid>
                        <ControlTemplate.Triggers>
                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="Text" Value="" />
                                </MultiTrigger.Conditions>
                                <Setter TargetName="WaterMarkLabel" Property="Visibility" Value="Visible" />
                            </MultiTrigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="DimGray" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="myButton" TargetType="{x:Type Button}">
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Padding" Value="1" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Grid x:Name="grid">
                            <Border
                                x:Name="border"
                                Background="White"
                                BorderBrush="White"
                                BorderThickness="1">

                                <ContentPresenter
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    TextElement.FontWeight="Normal" />
                            </Border>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="Red" />
                                <Setter TargetName="border" Property="TextElement.Foreground" Value="White" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <!--#endregion-->

    <Grid>
        <!--#region Row & Column Definitions-->
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="10" />
            <ColumnDefinition />
            <ColumnDefinition Width="10" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="24" />
            <RowDefinition Height="*" />
            <RowDefinition Height="auto" />
            <RowDefinition Height="auto" />
            <RowDefinition Height="24" />
        </Grid.RowDefinitions>
        <!--#endregion-->

        <DockPanel
            Grid.Row="0"
            Grid.Column="0"
            Grid.ColumnSpan="3"
            Height="24"
            LastChildFill="False">
            <!--#region Menu-->
            <Menu
                x:Name="mnuMain"
                Height="24"
                DockPanel.Dock="Top"
                FontSize="14">
                <MenuItem Header="File">
                    <MenuItem
                        x:Name="mnuCopy"
                        Click="MnuCopy_Click"
                        Header="Copy Grid to Clipboard"
                        InputGestureText="Ctrl+Shift+C">
                        <MenuItem.Icon>
                            <Image Source="/Icons/clipboard-plus.png" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator />
                    <MenuItem
                        Click="MnuSaveText_Click"
                        Header="Save Details to Text File"
                        InputGestureText="Ctrl+S">
                        <MenuItem.Icon>
                            <Image Source="/Icons/disk--pencil.png" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator />
                    <MenuItem
                        x:Name="mnuExit"
                        Click="MnuExit_Click"
                        Header="E_xit"
                        InputGestureText="Alt+F4">
                        <MenuItem.Icon>
                            <Image Source="/Icons/door--arrow.png" />
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                <MenuItem Header="View">
                    <MenuItem
                        x:Name="mnuRefresh"
                        Click="MnuRefresh_Click"
                        Header="_Refresh" InputGestureText="F5">
                        <MenuItem.Icon>
                            <Image Source="/Icons/arrow-circle-double.png" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator />
                    <MenuItem Header="_Zoom">
                        <MenuItem
                            Click="GridSmaller_Click"
                            Header="_Smaller"
                            InputGestureText="NumPad -"
                            StaysOpenOnClick="True">
                            <MenuItem.Icon>
                                <Image Source="/Icons/magnifier-zoom-out.png" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem
                            Click="GridLarger_Click"
                            Header="_Larger"
                            InputGestureText="NumPad +"
                            StaysOpenOnClick="True">
                            <MenuItem.Icon>
                                <Image Source="/Icons/magnifier-zoom-in.png" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator />
                        <MenuItem
                            Click="GridReset_Click"
                            Header="_Reset"
                            InputGestureText="NumPad 0"
                            StaysOpenOnClick="True">
                            <MenuItem.Icon>
                                <Image Source="/Icons/magnifier-zoom-actual-equal.png" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem.Icon>
                            <Image Source="/Icons/magnifier.png" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator />
                    <MenuItem Click="Font_Click" Header="_Font">
                        <MenuItem.Icon>
                            <Image Source="/Icons/font.png" />
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                <MenuItem Header="Options">
                    <MenuItem
                        x:Name="mnuEditExcludes"
                        Click="MnuEditExcludes_Click"
                        Header="Edit Exclude List">
                        <MenuItem.Icon>
                            <Image Source="/Icons/document--pencil.png" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem
                        x:Name="mnuHideDefender"
                        Checked="MnuHideDefender_Click"
                        Header="Hide Excluded"
                        IsCheckable="True"
                        IsChecked="{Binding HideExcluded, Source={x:Static p:Settings.Default}}"
                        Unchecked="MnuHideDefender_Click" />
                    <Separator />
                    <MenuItem
                        x:Name="mnuHideDetails"
                        Header="Show Details Pane"
                        IsCheckable="True"
                        IsChecked="{Binding HideDetails, Source={x:Static p:Settings.Default}}" />
                    <Separator />
                    <MenuItem
                        x:Name="mnuShadeAltRows"
                        Header="Shade Alternating Rows"
                        IsCheckable="True"
                        IsChecked="{Binding ShadeAltRows, Source={x:Static p:Settings.Default}}" />
                    <MenuItem
                        x:Name="mnuGridLines"
                        Header="Show Grid Lines"
                        IsCheckable="True"
                        IsChecked="{Binding ShowGridLines, Source={x:Static p:Settings.Default}}" />
                </MenuItem>
                <MenuItem x:Name="mnuHelp" Header="_Help">
                    <MenuItem
                        Name="mnuAbout"
                        Click="MnuAbout_Click"
                        Header="_About">
                        <MenuItem.Icon>
                            <Image Source="/Icons/information.png" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator />
                    <MenuItem
                        Name="mnuReadme"
                        Click="MnuReadme_Click"
                        Header="View ReadMe File">
                        <MenuItem.Icon>
                            <Image Source="/Icons/document-list.png" />
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Debug">
                        <MenuItem
                            Name="mnuViewTemp"
                            Click="ViewTemp_Click"
                            Header="View _Log File">
                            <MenuItem.Icon>
                                <Image Source="/Icons/document-list.png" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator />
                        <MenuItem
                            Name="mnuViewExcl"
                            Click="MnuViewExcl_Click"
                            Header="View _Exclude File">
                            <MenuItem.Icon>
                                <Image Source="/Icons/json.png" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem.Icon>
                            <Image Source="/Icons/bug.png" />
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
            </Menu>
            <!--#endregion-->

            <!--#region Search box-->
            <StackPanel Margin="208,-24,0,0" Orientation="Horizontal">
                <TextBox
                    x:Name="tbxSearch"
                    Width="200"
                    Height="24"
                    FontSize="15"
                    Style="{StaticResource MyWaterMarkStyle}"
                    Tag="Filter Title Column"
                    TextChanged="TbxSearch_TextChanged" />
                <Button
                    x:Name="btnSearch"
                    Width="12"
                    Height="15"
                    Margin="-20,0,0,0"
                    Background="White"
                    BorderThickness="0"
                    Click="BtnSearch_Click"
                    Content="X"
                    FontSize="10"
                    Foreground="Black"
                    Style="{DynamicResource myButton}" />
            </StackPanel>
            <!--#endregion-->
        </DockPanel>

        <!--#region DataGrid-->
        <DataGrid
            x:Name="dataGrid"
            Grid.Row="1"
            Grid.Column="0"
            Grid.ColumnSpan="3"
            MinWidth="100"
            MinHeight="100"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            AutoGenerateColumns="False"
            Background="WhiteSmoke"
            BorderBrush="#E2E2E2"
            CanUserAddRows="False"
            CanUserDeleteRows="False"
            FontFamily="{Binding FontFamily, Source={x:Static p:Settings.Default}}"
            FontSize="14"
            HeadersVisibility="Column"
            HorizontalGridLinesBrush="#d0d0d0"
            IsReadOnly="True"
            PreviewMouseWheel="DataGrid_PreviewMouseWheel"
            SelectionMode="Single"
            VerticalGridLinesBrush="#d0d0d0"
            VerticalScrollBarVisibility="Visible">

            <DataGrid.Columns>
                <DataGridTextColumn
                    Binding="{Binding KBNum}"
                    ElementStyle="{StaticResource ColumnMargin5}"
                    Header="KB Number" />
                <DataGridTextColumn
                    Binding="{Binding Date, StringFormat='MM/dd/yyyy  HH:mm'}"
                    ElementStyle="{StaticResource ColumnMargin5}"
                    Header="Date &amp; Time" />
                <DataGridTextColumn
                    Binding="{Binding Title}"
                    ElementStyle="{StaticResource ColumnMargin5}"
                    Header="Title" />
                <DataGridTextColumn
                    Binding="{Binding ResultCode}"
                    ElementStyle="{StaticResource ColumnMargin5}"
                    Header="Result" />
            </DataGrid.Columns>
        </DataGrid>
        <!--#endregion-->

        <!--#region GridSplitter-->
        <GridSplitter
            Grid.Row="2"
            Grid.Column="0"
            Grid.ColumnSpan="3"
            Height="5"
            Margin="0,0,0,0"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Center"
            Background="LightSteelBlue"
            BorderThickness="0"
            IsTabStop="False"
            ResizeDirection="Rows" />
        <!--#endregion-->

        <!--#region Details area-->
        <ScrollViewer
            x:Name="sc1"
            Grid.Row="3"
            Grid.Column="0"
            Grid.ColumnSpan="3"
            Padding="2"
            Background="AliceBlue"
            FontFamily="{Binding FontFamily, Source={x:Static p:Settings.Default}}"
            FontSize="14"
            VerticalScrollBarVisibility="Visible">
            <ScrollViewer.DataContext>
                <Binding ElementName="dataGrid" Path="SelectedItem" />
            </ScrollViewer.DataContext>
            <StackPanel>
                <TextBlock
                    Margin="5,2"
                    FontWeight="Bold"
                    Text="Windows Update details:" />
                <StackPanel Margin="5,2" Orientation="Horizontal">
                    <TextBlock Width="140" Text="Title:" />
                    <TextBlock
                        MaxWidth="1000"
                        Text="{Binding Title}"
                        TextWrapping="Wrap" />
                </StackPanel>
                <StackPanel Margin="5,2" Orientation="Horizontal">
                    <TextBlock Width="140" Text="KB Number:" />
                    <TextBlock Text="{Binding KBNum}" />
                </StackPanel>
                <StackPanel Margin="5,2" Orientation="Horizontal">
                    <TextBlock Width="140" Text="Date:" />
                    <TextBlock Text="{Binding Date}" />
                </StackPanel>
                <StackPanel Margin="5,2" Orientation="Horizontal">
                    <TextBlock Width="140" Text="Description:" />
                    <TextBlock
                        MaxWidth="850"
                        Text="{Binding Description}"
                        TextWrapping="Wrap" />
                </StackPanel>
                <StackPanel Margin="5,2" Orientation="Horizontal">
                    <TextBlock Width="140" Text="Operation:" />
                    <TextBlock Text="{Binding Operation}" />
                </StackPanel>
                <StackPanel Margin="5,2" Orientation="Horizontal">
                    <TextBlock Width="140" Text="Result Code:" />
                    <TextBlock Text="{Binding ResultCode}" />
                </StackPanel>
                <StackPanel Margin="5,2" Orientation="Horizontal">
                    <TextBlock Width="140" Text="HResult:" />
                    <TextBlock Text="{Binding HResult}" />
                </StackPanel>

                <StackPanel Margin="5,2" Orientation="Horizontal">
                    <TextBlock Width="140" Text="Update ID:" />
                    <TextBlock Text="{Binding UpdateID}" />
                </StackPanel>
                <StackPanel Margin="5,2" Orientation="Horizontal">
                    <TextBlock Width="140" Text="Support URL:" />
                    <TextBlock>
                        <Hyperlink NavigateUri="{Binding SupportURL}" RequestNavigate="Hyperlink_RequestNavigate">
                            <Hyperlink.Inlines>
                                <Run Text="{Binding Path=SupportURL}" />
                            </Hyperlink.Inlines>
                        </Hyperlink>
                    </TextBlock>
                </StackPanel>

                <TextBlock
                    Margin="5,12,0,0"
                    FontWeight="Bold"
                    Text="Windows Event Log details:" />
                <TextBlock
                    MaxWidth="1020"
                    Margin="7,0"
                    HorizontalAlignment="Left"
                    LineHeight="22"
                    LineStackingStrategy="BlockLineHeight"
                    Text="{Binding ELDescription}"
                    TextWrapping="Wrap" />

            </StackPanel>
        </ScrollViewer>
        <!--#endregion-->

        <!--#region Item count display-->
        <Grid
            Grid.Row="4"
            Grid.Column="0"
            Grid.ColumnSpan="3"
            Background="Gainsboro">
            <StackPanel Orientation="Horizontal">
                <TextBlock
                    x:Name="tb1"
                    Padding="5,1"
                    Background="Gainsboro"
                    FontSize="14"
                    Foreground="Black"
                    Text="item count" />
                <TextBlock
                    x:Name="tb2"
                    Margin="10,1"
                    Background="Gainsboro"
                    FontSize="14"
                    Foreground="Black" />
            </StackPanel>
        </Grid>
        <!--#endregion-->
    </Grid>
</Window>
